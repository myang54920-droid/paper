<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ë“¤ë§Œì˜ ë¡¤ë§í˜ì´í¼</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f5f7f9; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .container { width: 100%; max-width: 450px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.05); box-sizing: border-box; }
        h2 { text-align: center; color: #333; margin-bottom: 25px; font-size: 20px; }
        label { font-size: 13px; color: #888; margin-bottom: 5px; display: block; padding-left: 5px; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 16px; background: #fafafa; }
        button { width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-bottom: 10px; }
        .btn-write { background-color: #00c853; color: white; }
        .btn-read { background-color: #2979ff; color: white; }
        
        /* ë©”ì‹œì§€ ì¹´ë“œ ë””ìì¸ ìˆ˜ì • */
        .msg-card { background: #fff; padding: 20px; margin-top: 15px; border-radius: 12px; border: 1px solid #f0f0f0; border-left: 5px solid #ffd600; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .msg-text { font-size: 16px; color: #333; line-height: 1.5; margin-bottom: 15px; word-break: break-all; }
        .msg-footer { display: flex; justify-content: space-between; align-items: center; }
        .msg-time { font-size: 11px; color: #bbb; }
        .btn-del-req { font-size: 11px; color: #ff5252; background: none; border: 1px solid #ff5252; padding: 4px 8px; cursor: pointer; border-radius: 5px; transition: 0.3s; }
        .btn-del-req:hover { background: #ff5252; color: white; }

        .admin-link { margin-top: 40px; font-size: 12px; color: #ddd; cursor: pointer; text-align: center; }
        hr { margin: 30px 0; border: 0; border-top: 1px solid #eee; }
        
        /* ê´€ë¦¬ì ëª¨ë“œ ë²„íŠ¼ ë””ìì¸ */
        .admin-box { background: #333; color: white; padding: 15px; border-radius: 12px; margin-top: 10px; font-size: 13px; line-height: 1.6; }
        .btn-real-del { background: #ff5252; color: white; padding: 4px 8px; border-radius: 5px; font-size: 11px; margin-top: 10px; width: auto; }
    </style>
</head>
<body>

<div class="container">
    <h2>âœï¸ í¸ì§€ ë‚¨ê¸°ê¸°</h2>
    <label>ë°›ëŠ” ì‚¬ëŒ</label>
    <input list="nameList" id="targetName" placeholder="ì´ë¦„ ê²€ìƒ‰/ì„ íƒ">
    <datalist id="nameList"></datalist>
    <textarea id="message" rows="4" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
    <button class="btn-write" onclick="writeMsg()">í¸ì§€ ë³´ë‚´ê¸°</button>

    <hr>

    <h2>ğŸ” ë‚´ í¸ì§€í•¨ í™•ì¸</h2>
    <label>ë‚´ ì´ë¦„</label>
    <input list="nameList" id="myName" placeholder="ë‚´ ì´ë¦„ ê²€ìƒ‰/ì„ íƒ">
    <label>ë¹„ë°€ë²ˆí˜¸</label>
    <input type="password" id="myPw" placeholder="ë‚˜ë§Œ ì•„ëŠ” ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
    <button class="btn-read" onclick="readMsg()">ë³´ì•ˆ ì—´ëŒí•˜ê¸°</button>
    <div id="display"></div>

    <div class="admin-link" onclick="toggleAdmin()">ê´€ë¦¬ì ëª¨ë“œ</div>
    <div id="adminArea" style="display:none; width: 100%;">
        <input type="password" id="adminPw" placeholder="ê´€ë¦¬ì ë¹„ë²ˆ">
        <button onclick="loadAdminMsgs()" style="background:#555; color:white;">ì „ì²´ ì¡°íšŒ</button>
        <div id="adminDisplay"></div>
    </div>
</div>

<script>
    const members = ["ì•ˆí˜ì§„ ë³¸ë¶€ì¥", "ë°±ì•„í˜„ ë¶€ë³¸ë¶€ì¥", "ì´ë¶„í¬ ë³¸ë¶€ì¥", "ê°œì²­ìš´ ë¶€ë³¸ë¶€ì¥", "ê°€í˜„ìš° ëŒ€ë¦¬", "ë§ˆì²œìš° ëŒ€ë¦¬", "ì„œì´ì¤€ ê³¼ì¥", "í•œìœ¨ ëŒ€ë¦¬", "ì„œí›ˆ ëŒ€ë¦¬", "ê°€ë¹„ìš° ì‚¬ì›", "ê°•ìŠ¹í˜œì‚¬ì›", "ê°•ìœ ì§„ ì£¼ì„", "ê²Œêµ­ì§€ ì‚¬ì›", "ê³ ë´‰ì‹ ëŒ€ë¦¬", "ê³½ìš©íŒ” ëŒ€ë¦¬", "êµ¬ìˆœë˜ ì‚¬ì›", "êµ¬ìœ¤í˜¸ ì‚¬ì›", "ê¹€ì„ í¬ ì‚¬ì›", "ë‹¹ì‹œì•„ ì‚¬ì›", "ë£¨ë£¨ì™€ ì‚¬ì›", "ë§ˆí’ê°• ì‚¬ì›", "ë¯¼ì§€ì„± ì‚¬ì›", "ë°•ê·œì‹ ì‚¬ì›", "ë°•ì„±ì€ ëŒ€ë¦¬", "ë°°í•˜ì§„ ì¸í„´", "ë°±ì€í˜¸ ì‚¬ì›", "ë°±ì •í›ˆ ê³¼ì¥", "ë°±í¬ ì£¼ì„", "ì„œì—¬ë¦¬ ì£¼ì„", "ì„œìœ¤ì„œ ì‚¬ì›", "ì„œìœ¤ì œ ì£¼ì„", "ì„ ì£¼í˜œ ì¸í„´", "ì†Œë„ë¦¬ ì£¼ì„", "ì†Œí•œë¹ˆ ì‚¬ì›", "ì‹ ì‹œì•„ ì‚¬ì›", "ì–‘í•´ì§„ ëŒ€ë¦¬", "ì—„í‘ë¯¼ ì‚¬ì›", "ì˜ˆê·œë¹ˆ ì‚¬ì›", "ìœ ì—¬í•œ ëŒ€ë¦¬", "ìœ ì¬ë¯¼ ì‚¬ì›", "ìœ¤ íƒ ì‚¬ì›", "ìœ¤ê²¬ ëŒ€ë¦¬", "ìœ¤ì£¼ì› ì£¼ì„", "ìœ¤íƒœì¤€ ëŒ€ë¦¬", "ì´ë‹¤ì†” ì‚¬ì›", "ì´ë™ì‹ ëŒ€ë¦¬", "ì´ë¦¬ë‚˜ ëŒ€ë¦¬", "ì´ë¯¸ì§€ ì‚¬ì›", "ì´ì•„ëŒ ëŒ€ë¦¬", "ì´í•´ë¯¸ ì¸í„´", "ìì†Œí¬ ì‚¬ì›", "ì¥ì˜ì‚¬ ì£¼ì„", "ì • ìœ¤ ê³¼ì¥", "ì§€ì‚° ëŒ€ë¦¬", "ì°¨ê±´ìš° ì‚¬ì›", "ì°¨ì§€ì•ˆ ì‚¬ì›", "ì°¨ì§€ì˜¨ ì‚¬ì›", "ì°¨í˜„ ì‚¬ì›", "ì±„ì„œë¦° ëŒ€ë¦¬", "ì±„ì´ì„¤ ëŒ€ë¦¬", "í•¨ì±„ë¯¸ ì‚¬ì›", "í—ˆì±„í—Œ ì‚¬ì›", "í˜¸ê°•ì„¸ ê³¼ì¥"];
    
    // â­ ì—¬ê¸°ì— êµ¬ê¸€ ë°°í¬ URLì„ ë‹¤ì‹œ ê¼­ ë„£ì–´ì£¼ì„¸ìš”!
    const APP_URL = "https://script.google.com/macros/s/AKfycbyBhPfBgA2x9Su2LfvPVRKfwxl3iDtsyw84kQjz3XnUCfnn26egnVXnWOajzvGaFH0P/exec";

    const dataList = document.getElementById('nameList');
    members.sort().forEach(n => { const o = document.createElement('option'); o.value = n; dataList.appendChild(o); });

    async function writeMsg() {
        const name = document.getElementById('targetName').value;
        const msg = document.getElementById('message').value;
        if(!members.includes(name) || !msg) return alert("ì…ë ¥ì„ í™•ì¸í•˜ì„¸ìš”.");
        await fetch(APP_URL, { method: 'POST', body: JSON.stringify({ action: 'write', name, msg }) });
        alert("ë³´ëƒˆìŠµë‹ˆë‹¤!"); location.reload();
    }

    async function readMsg() {
        const name = document.getElementById('myName').value;
        const pw = document.getElementById('myPw').value;
        const disp = document.getElementById('display');
        disp.innerHTML = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
        const res = await fetch(APP_URL, { method: 'POST', body: JSON.stringify({ action: 'read', name, pw }) });
        const msgs = await res.json();
        disp.innerHTML = msgs.length ? "" : "ë‚´ìš©ì´ ì—†ê±°ë‚˜ ë¹„ë²ˆì´ í‹€ë ¸ìŠµë‹ˆë‹¤.";
        msgs.reverse().forEach(m => {
            disp.innerHTML += `<div class="msg-card">
                <div class="msg-text">${m.msg}</div>
                <div class="msg-footer">
                    <span class="msg-time">${new Date(m.time).toLocaleDateString()}</span>
                    <button class="btn-del-req" onclick="requestDelete('${name}', '${m.msg}')">ì‚­ì œìš”ì²­</button>
                </div>
            </div>`;
        });
    }

    async function requestDelete(name, msg) {
        if(!confirm("ìš´ì˜ìì—ê²Œ ì‚­ì œë¥¼ ìš”ì²­í• ê¹Œìš”?")) return;
        await fetch(APP_URL, { method: 'POST', body: JSON.stringify({ action: 'requestDelete', name, msg }) });
        alert("ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function toggleAdmin() { const a = document.getElementById('adminArea'); a.style.display = a.style.display === 'none' ? 'block' : 'none'; }

    async function loadAdminMsgs() {
        const pw = document.getElementById('adminPw').value;
        const res = await fetch(APP_URL, { method: 'POST', body: JSON.stringify({ action: 'adminRead', pw }) });
        const data = await res.json();
        const disp = document.getElementById('adminDisplay');
        if(data.length === 0) { disp.innerHTML = "ë¹„ë²ˆì´ í‹€ë ¸ê±°ë‚˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."; return; }
        disp.innerHTML = data.map(m => `
            <div class="admin-box" style="${m.isRequest === 'Y' ? 'border:2px solid red;' : ''}">
                <div><b>[${m.name}]</b> ${m.msg}</div>
                <button class="btn-real-del" onclick="adminDelete(${m.id})">ì§„ì§œì‚­ì œ</button>
            </div>
        `).join('');
    }

    async function adminDelete(rowId) {
        if(!confirm("ì •ë§ ì§€ì›ë‹ˆê¹Œ?")) return;
        const pw = document.getElementById('adminPw').value;
        await fetch(APP_URL, { method: 'POST', body: JSON.stringify({ action: 'adminDelete', pw, rowId }) });
        alert("ì‚­ì œë¨"); loadAdminMsgs();
    }
</script>
</body>
</html>
